FROM node:18

ARG ARG_URL
ENV URL=$ARG_URL

ARG ARG_FORTYTWO_CLIENT_ID
ENV FORTYTWO_CLIENT_ID=$ARG_FORTYTWO_CLIENT_ID

ARG ARG_FORTYTWO_CLIENT_SECRET
ENV FORTYTWO_CLIENT_SECRET=$ARG_FORTYTWO_CLIENT_SECRET

ARG ARG_JWT_SECRET
ENV JWT_SECRET=$ARG_JWT_SECRET

ARG TWO_FACTOR_AUTHENTICATION_APP_NAME
ENV TWO_FACTOR_AUTHENTICATION_APP_NAME=$ARG_TWO_FACTOR_AUTHENTICATION_APP_NAME

WORKDIR /usr/src/app

COPY src/package*.json ./

RUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm

RUN pnpm install

COPY src/. .

EXPOSE 6000 7000 7001 7002 7003 4001

CMD [ "pnpm", "start" ]